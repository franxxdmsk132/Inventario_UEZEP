<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Etiquetas meta requeridas -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <style>
        /* Estilos CSS aquí */
    </style>
    <title>Asignacion de Muebles</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body class="body-gradient">
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="text-center">
                <br>
                <h3>
                    <img th:src="@{/images/Logo-NBG.png}" class="d-inline-block align-text-top" width="40" height="40" alt="icon">
                    <b>Mobiliario de Departamentos</b>
                </h3>
                <h4>
                    <a th:href="@{/depmub/lista}" class="btn btn-warning btn-sm mb-3 d-inline-block align-text-top">ATRAS</a>
                </h4>
                <hr>
                <h2>Asignar Muebles en un Departamento</h2>
            </div>
            <form action="/depmub/save" method="post" th:object="${asignacionForm}" onsubmit="validarFormulario(event)" class="d-flex flex-column align-items-center">
                <!-- Selección de departamentos -->
                <div class="form-group">
                    <label for="id_departamento" class="h4">Selecciona un Departamento:</label>
                    <select id="id_departamento" name="id_departamento" class="form-control">
                        <option value="" disabled selected>Seleccione un departamento</option>
                        <!-- Iteración sobre la lista de departamentos disponibles -->
                        <option th:each="departamento : ${allDepartamentos}" th:value="${departamento.id_departamento}"
                                th:text="${departamento.tipo_departamento + ' - ' + departamento.tipo_jornada}"></option>
                    </select>
                    <div id="selectError" class="invalid-feedback" style="display: none;">Por favor, selecciona un departamento para continuar</div>
                </div>
                <!-- Lista de muebles -->
                <div class="form-group">
                    <label class="h4">Selecciona los Muebles:</label>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <table class="table">
                                    <tbody>
                                    <!-- Iteración sobre la mitad de la lista de muebles disponibles -->
                                    <tr th:each="mueble, i: ${allMuebles}" th:if="${i.index % 2 == 0}">
                                        <td>
                                            <div class="form-check">
                                                <input type="checkbox" name="id_mueble[]" th:value="${mueble.id_mueble}"
                                                       class="form-check-input" onclick="habilitarCantidad(this)">
                                                <label th:for="${'mueble' + mueble.id_mueble}"
                                                       class="form-check-label h5"
                                                       th:text="${mueble.codigo_mueble + ' - ' + mueble.nombre_mueble }"></label>
                                                <span class="cantidad-disponible" th:text="'Cantidad Disponible: ' + ${mueble.cantidad}"></span>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" name="cantidad[]" class="form-control cantidad"
                                                   placeholder="Cantidad" disabled>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <table class="table">
                                    <tbody>
                                    <!-- Iteración sobre la otra mitad de la lista de muebles disponibles -->
                                    <tr th:each="mueble, i: ${allMuebles}" th:if="${i.index % 2 == 1}">
                                        <td>
                                            <div class="form-check">
                                                <input type="checkbox" name="id_mueble[]" th:value="${mueble.id_mueble}"
                                                       class="form-check-input" onclick="habilitarCantidad(this)">
                                                <label th:for="${'mueble' + mueble.id_mueble}"
                                                       class="form-check-label h5"
                                                       th:text="${mueble.codigo_mueble + ' - ' + mueble.nombre_mueble }"></label>
                                                <span class="cantidad-disponible" th:text="'Cantidad Disponible: ' + ${mueble.cantidad}"></span>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" name="cantidad[]" class="form-control cantidad"
                                                   placeholder="Cantidad" disabled>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Asignar Muebles</button>
            </form>
            <br>
        </div>
    </div>
</div>
</body>
<script>
    function habilitarCantidad(checkbox) {
        // Obtener el campo de cantidad asociado al checkbox actual
        var cantidadInput = checkbox.parentElement.parentElement.nextElementSibling.querySelector('input[name="cantidad"]');
        // Obtener la cantidad disponible del span
        var cantidadDisponible = checkbox.parentElement.querySelector('.cantidad-disponible').innerText;
        // Quitar "Cantidad Disponible: " del texto y convertirlo a número
        cantidadDisponible = parseInt(cantidadDisponible.replace('Cantidad Disponible: ', ''));
        // Habilitar o deshabilitar el campo de cantidad según el estado del checkbox
        cantidadInput.disabled = !checkbox.checked;
        // Si el checkbox está marcado, limitar el valor del input al valor disponible
        if (checkbox.checked) {
            cantidadInput.max = cantidadDisponible;
            // Validar el valor ingresado
            cantidadInput.addEventListener('input', function() {
                var valorIngresado = parseInt(this.value);
                if (valorIngresado > cantidadDisponible) {
                    // Si el valor ingresado es mayor que la cantidad disponible, cambiar el estilo del input y mostrar un mensaje
                    this.style.borderColor = 'red';
                    this.setCustomValidity('No puede superar la cantidad disponible');
                } else {
                    // Si el valor ingresado es válido, restaurar el estilo y quitar el mensaje de error
                    this.style.borderColor = '';
                    this.setCustomValidity('');
                }
            });
            // Validar si el campo está vacío cuando se marca el checkbox
            if (cantidadInput.value === "") {
                cantidadInput.style.borderColor = 'red'; // Marcar en rojo el campo de cantidad
                cantidadInput.setCustomValidity('Este campo no puede estar vacío'); // Mostrar mensaje de error
            }
        } else {
            // Si el checkbox está desmarcado, quitar la limitación de valor y restaurar el estilo del input
            cantidadInput.max = '';
            cantidadInput.style.borderColor = '';
            cantidadInput.setCustomValidity('');
        }
    }

    function activarCheckbox(div) {
        var checkbox = div.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        habilitarCantidad(checkbox);
    }

</script>

<script>
    // Función para manejar la selección de muebles
    function handleSelection() {
        var selectElement = document.getElementById("idMuebles");
        var selectedMuebles = [];

        // Reiniciar la lista de muebles seleccionados
        document.getElementById("selectedMuebles").innerHTML = "";

        // Obtener todos los muebles seleccionados
        for (var i = 0; i < selectElement.selectedOptions.length; i++) {
            var selectedOption = selectElement.selectedOptions[i];
            var selectedMuebleId = selectedOption.value;
            var selectedMuebleName = selectedOption.text;

            selectedMuebles.push(selectedMuebleId);

            // Mostrar los muebles seleccionados
            var selectedMueblesLabel = document.getElementById("selectedMuebles");
            selectedMueblesLabel.innerHTML += "<span>" + selectedMuebleName + "</span>, ";
        }

        // Actualizar el valor del campo de texto oculto
        var hiddenInput = document.getElementById("selectedMueblesIds");
        hiddenInput.value = selectedMuebles.join(",");
    }
</script>

<script>
    // Función para validar el formulario
    function validarFormulario(event) {
        // Obtener el select de departamento
        var selectDepartamento = document.getElementById("id_departamento");
        var mueblesSeleccionados = document.querySelectorAll('input[name="id_mueble"]:checked');

        // Verificar si se ha seleccionado un aula válida
        if (selectDepartamento.value === "") {
            selectDepartamento.setCustomValidity("Por favor, selecciona un departamento para continuar"); // Establecer mensaje personalizado
            event.preventDefault(); // Evitar el envío del formulario
        } else if (mueblesSeleccionados.length === 0) {
            alert("Por favor, selecciona al menos un mueble."); // Mostrar mensaje de alerta
            event.preventDefault(); // Evitar el envío del formulario
        } else {
            selectAula.setCustomValidity(""); // Restablecer mensaje de validación
        }
    }
</script>








</html>
